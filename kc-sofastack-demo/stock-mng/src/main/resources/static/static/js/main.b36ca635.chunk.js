(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{120:function(e,t,a){e.exports=a(210)},125:function(e,t,a){},210:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(6),s=a.n(c),o=(a(125),a(9)),i=a.n(o),l=a(13),u=a(18),d=a(19),m=a(22),p=a(20),h=a(23),f=a(213),g=a(216),v=a(214),b=a(211),E=a(2),y=a.n(E),k=a(10),w=a(212),C=a(39),N=a(215),x=function(e){return Math.min(99,Math.max(0,e))};var O=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).onChange=function(e){var t;e.target.value?(t=e.target.value,isNaN(t)||parseInt(t)!==+t||a.props.onChange(x(+e.target.value))):a.props.onChange(0)},a.increment=function(e){var t=a.props.value+e;isNaN(t)&&(t=0),a.props.onChange(x(t))},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"number-component"},r.a.createElement(C.a,{disabled:this.props.disabled,shape:"circle",onClick:function(){return e.increment(-1)}},r.a.createElement(k.a,{type:"minus"})),r.a.createElement("span",null,r.a.createElement(N.a,{disabled:this.props.disabled,className:"input",value:this.props.value,onChange:this.onChange})),r.a.createElement(C.a,{disabled:this.props.disabled,shape:"circle",onClick:function(){return e.increment(1)}},r.a.createElement(k.a,{type:"plus"})))}}]),t}(n.Component),j=function(){},S=function(e){function t(e,a){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this,e,a))).order=Object(l.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({loading:!0}),e.prev=1,e.next=4,n.props.onOrder(n.state.orderCount);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:n.setState({orderCount:0,loading:!1});case 9:case"end":return e.stop()}},e,null,[[1,6]])})),n.state={orderCount:0,loading:!1},n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:y()({"stock-item":!0,enlarged:this.props.enlarged,hidden:this.props.hidden})},r.a.createElement("div",{className:"main"},r.a.createElement("div",{className:"name",onClick:this.props.enlarged?j:this.props.onEnlarge},r.a.createElement("span",{className:"return-icon",onClick:this.props.enlarged?this.props.onShrink:j},r.a.createElement(k.a,{type:"arrow-left"})),r.a.createElement("span",{className:"book-name"},this.props.name),r.a.createElement("span",{className:"author"},this.props.author)),r.a.createElement("div",{className:"price"},"\u5355\u4ef7: \xa5",(+this.props.price).toFixed(2)),!!this.props.imageUrl&&r.a.createElement("div",{onClick:this.props.enlarged?j:this.props.onEnlarge},r.a.createElement("img",{src:this.props.imageUrl,alt:"",className:"main-img"})),this.props.loading?r.a.createElement("div",{className:"purchased"},"\xa0",r.a.createElement(b.a,{size:"small"})):r.a.createElement("div",{className:"purchased"},"\u5df2\u8d2d: ",this.props.ownedCount||0," \u4ef6",this.props.stockCount>=0&&r.a.createElement("span",{className:"stock-count"},"\u5e93\u5b58",this.props.stockCount||0,"\u4ef6"))),r.a.createElement("div",{className:"side"},r.a.createElement(O,{value:this.state.orderCount,onChange:function(t){return e.setState({orderCount:t})},disabled:this.state.loading}),r.a.createElement(w.a,{placement:"left",title:"\u786e\u5b9a\u8981\u8ba2\u8d2d".concat(this.state.orderCount,"\u4ef6 ").concat(this.props.name," \u5417\uff1f (\u603b\u4ef7").concat((this.state.orderCount*this.props.price).toFixed(2),"\u5143)"),className:this.state.orderCount?"":"disabled",onConfirm:this.order},r.a.createElement(C.a,{className:"purchase-button",type:"primary",disabled:!this.state.orderCount,loading:this.state.loading},"\u8ba2\u8d2d"))),r.a.createElement("div",{className:y()({hidden:!this.props.enlarged,"item-description":!0,"with-image":!!this.props.imageUrl})},this.props.description?r.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.description}}):r.a.createElement("div",{style:{opacity:.7}},"\u5546\u54c1\u6682\u65e0\u8be6\u7ec6\u8bf4\u660e")),this.props.enlarged&&!!this.props.imageUrl&&r.a.createElement("img",{src:"",alt:"",className:"item-image",style:{backgroundImage:"url('".concat(this.props.imageUrl,"')")}}))}}]),t}(n.Component),I=function(e){function t(e,a){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this,e,a))).updateCurrent=function(){n.state.current!==n.props.balance&&(Math.abs(n.state.current-n.props.balance)<.01?n.setState({current:n.props.balance}):n.setState({current:n.state.current+(n.props.balance-n.state.current)/10}))},n.state={current:n.props.balance},setInterval(n.updateCurrent,10),n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"balance-component"},"\u53ef\u7528\u4f59\u989d ",null===this.props.balance?r.a.createElement("span",null,"..."):r.a.createElement("span",null,"\xa5 ",(+this.state.current).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")))}}]),t}(n.Component),U=a(66),B=function(e){function t(e,a){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this,e,a))).switchUser=function(){delete localStorage.userName,window.location.reload()},n.state={userName:localStorage.userName},setInterval(function(){n.setState({userName:localStorage.userName})},1e3),n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return this.state.userName?r.a.createElement("div",{className:"username-display"},r.a.createElement(k.a,{type:"user"}),r.a.createElement(U.a,{title:"\u7528\u6237\u6807\u8bc6\u7b26: "+this.state.userName,placement:"bottomRight"},r.a.createElement("span",{className:"username-text"},this.state.userName)),r.a.createElement(w.a,{placement:"topLeft",title:"\u786e\u5b9a\u8981\u5207\u6362\u7528\u6237\u5417",onConfirm:this.switchUser},r.a.createElement(k.a,{type:"reload",className:"reload-btn"}))):null}}]),t}(n.Component),q=a(49),F=a.n(q);function H(e){if(!1===e.success)throw new Error("result.success===false")}function M(e){return"/"===window.backendUrl&&(window.backendUrl=window.location.origin),window.backendUrl.endsWith("/")&&(window.backendUrl=window.backendUrl.substr(0,window.backendUrl.length-1)),e.startsWith("/")||(e="/"+e),window.backendUrl+e}window.backendUrl=window.backendUrl||"/";var P={createUser:function(){var e=Object(l.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.a.post(M("/createUser"),{userName:t});case 3:H(e.sent.data),e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),g.a.error("Failed to create user: "+e.t0.message),e.t0;case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}(),query:function(){var e=Object(l.a)(i.a.mark(function e(t){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.a.post(M("/query"),{userName:t});case 3:return H(a=e.sent.data),e.abrupt("return",a);case 8:throw e.prev=8,e.t0=e.catch(0),g.a.error("Failed to query stock: "+e.t0.message),e.t0;case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}(),querySorted:function(){var e=Object(l.a)(i.a.mark(function e(t){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.a.post(M("/querySorted"),{userName:t});case 3:return H(a=e.sent.data),e.abrupt("return",a);case 8:throw e.prev=8,e.t0=e.catch(0),g.a.error("Failed to query stock: "+e.t0.message),e.t0;case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}(),queryBalance:function(){var e=Object(l.a)(i.a.mark(function e(t){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.a.post(M("/queryBalance"),{userName:t});case 3:return H(a=e.sent.data),e.abrupt("return",a);case 8:throw e.prev=8,e.t0=e.catch(0),g.a.error("Failed to query balance: "+e.t0.message),e.t0;case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}(),purchase:function(){var e=Object(l.a)(i.a.mark(function e(t,a,n){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.a.post(M("/purchase"),{userName:t,productCode:a,count:n});case 3:return H(r=e.sent.data),e.abrupt("return",r);case 8:throw e.prev=8,e.t0=e.catch(0),g.a.error("Failed to purchase: "+e.t0.message),e.t0;case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t,a,n){return e.apply(this,arguments)}}()},_=a(118),z=a(116),T=a.n(z),D={footerText:"Alipay \xa92019 / a KubeCon DEMO",initUser:function(){var e=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.userName){e.next=6;break}return t=T()(),e.next=5,P.createUser(t);case 5:localStorage.userName=t;case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),convertItems:function(e){return e.map(function(e){var t=Object(_.a)({},e);try{var a=JSON.parse(t.description);t.description=a.description,t.image_url=a.image_url,t.author=a.author}catch(n){}return t})}},L=f.a.Header,A=f.a.Content,J=f.a.Footer,K=function(e){function t(e,a){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this,e,a))).resizeHandler=function(){n.recalcEnlargedElementStyle&&n.recalcEnlargedElementStyle()},n.refreshStockItems=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.query(localStorage.userName);case 2:(t=e.sent).forEach(function(e){return e.loading=!1}),n.setState({stockItems:D.convertItems(t)});case 5:case"end":return e.stop()}},e)})),n.refreshBalance=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.queryBalance(localStorage.userName);case 2:t=e.sent,n.setState({balance:t.balance});case 4:case"end":return e.stop()}},e)})),n.onOrder=function(){var e=Object(l.a)(i.a.mark(function e(t,a){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.purchase(localStorage.userName,t.productCode,a);case 2:g.a.success("\u606d\u559c\uff0c\u8ba2\u8d2d\u6210\u529f"),n.setState({balance:n.state.balance-t.price*a}),t.loading=!0,n.setState({}),n.refreshStockItems(),n.refreshBalance();case 8:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),n.state={balance:null,stockItems:null,enlargedProductCode:null},n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=Object(l.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.initUser();case 2:return this.refreshBalance(),e.next=5,this.refreshStockItems();case 5:window.addEventListener("resize",this.resizeHandler);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resizeHandler)}},{key:"render",value:function(){var e=this;return r.a.createElement(f.a,{className:"layout"},r.a.createElement(L,null,r.a.createElement("div",{className:"logo"},"KubeCon DEMO")),r.a.createElement(A,{style:{padding:"0 50px"}},r.a.createElement(v.a,{style:{margin:"16px 0"}},r.a.createElement(v.a.Item,null,"Home"),r.a.createElement(v.a.Item,null,"\u5e93\u5b58\u7ba1\u7406")),r.a.createElement(B,null),r.a.createElement("div",{style:{background:"#fff",padding:24,minHeight:280},id:"stock-item-list"},!this.state.stockItems&&r.a.createElement("div",{className:"spin-div"},r.a.createElement(b.a,null)),!!this.state.stockItems&&this.state.stockItems.map(function(t){return r.a.createElement(S,{key:t.productCode,name:t.name,description:t.description,author:t.author,imageUrl:t.image_url,ownedCount:t.ownedCount,stockCount:t.stockCount,price:t.price,loading:t.loading,enlarged:e.state.enlargedProductCode===t.productCode,hidden:!!e.state.enlargedProductCode&&e.state.enlargedProductCode!==t.productCode,onEnlarge:function(){return e.onEnlarge(t.productCode)},onShrink:function(){return e.onShrink()},onOrder:function(a){return e.onOrder(t,a)}})}))),r.a.createElement(I,{balance:this.state.balance}),r.a.createElement(J,{style:{textAlign:"center"}},D.footerText))}},{key:"onEnlarge",value:function(e){var t=this;this.setState({enlargedProductCode:e},function(){for(var e=document.getElementById("stock-item-list"),a=e.getBoundingClientRect(),n=-1,r={},c=0;c<e.children.length;c++){var s=e.children[c].getBoundingClientRect();if(e.children[c].className.indexOf("enlarged")>=0){n=c;var o=s.y-a.y-24,i=a.y+a.height-s.y-s.height-24;r[c]="margin-top:".concat(o,"px;margin-bottom:").concat(i,"px;height:").concat(s.height,"px;")}else e.children[c].className.indexOf("hidden")>=0&&(r[c]="position:absolute; width:".concat(s.width,"px; top:").concat(s.y,"px"))}Object.keys(r).forEach(function(t){e.children[t].style=r[t]}),n>=0&&(t.recalcEnlargedElementStyle=function(){var t=.35.toFixed(2)+"s",r=document.body.clientHeight-a.y-window.scrollY-48-105;e.children[n].style="transition: opacity ".concat(t,", margin-top ").concat(t,", margin-bottom ").concat(t,", height ").concat(t,";margin-top:0; margin-bottom:0; height:").concat(r,"px")},setTimeout(t.recalcEnlargedElementStyle,350/3))})}},{key:"onShrink",value:function(){this.recalcEnlargedElementStyle=null;for(var e=document.getElementById("stock-item-list"),t=0;t<e.children.length;t++)e.children[t].style="";this.setState({enlargedProductCode:null})}}]),t}(n.Component),R=f.a.Header,W=f.a.Content,Y=f.a.Footer,$=function(e){function t(e,a){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this,e,a))).refreshStockItems=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.querySorted(localStorage.userName);case 2:(t=e.sent).forEach(function(e){return e.loading=!1}),n.setState({stockItems:D.convertItems(t)},function(){return console.log(n.state)});case 5:case"end":return e.stop()}},e)})),n.state={balance:null,stockItems:null,enlargedProductCode:null},n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=Object(l.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.initUser();case 2:return e.next=4,this.refreshStockItems();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(f.a,{className:"layout"},r.a.createElement(R,null,r.a.createElement("div",{className:"logo"},"KubeCon DEMO")),r.a.createElement(W,{style:{padding:"0 50px"}},r.a.createElement(v.a,{style:{margin:"16px 0"}},r.a.createElement(v.a.Item,null,"Home"),r.a.createElement(v.a.Item,null,"\u5e93\u5b58\u7ba1\u7406")),r.a.createElement("div",{style:{background:"#fff",padding:24,minHeight:280},id:"stock-item-list"},!this.state.stockItems&&r.a.createElement("div",{className:"spin-div"},r.a.createElement(b.a,null)),!!this.state.stockItems&&this.state.stockItems.map(function(e){return r.a.createElement("div",{className:"stock-item",key:e.productCode,style:{paddingLeft:75,paddingTop:20,paddingBottom:20}},r.a.createElement("div",{className:"main"},r.a.createElement("div",{className:"name",style:{marginBottom:3}},e.name),!!e.image_url&&r.a.createElement("div",null,r.a.createElement("img",{src:e.image_url,alt:"",className:"main-img"})),!!e.author&&r.a.createElement("div",{style:{marginBottom:2}},e.author)))}))),r.a.createElement(Y,{style:{textAlign:"center"}},D.footerText))}}]),t}(n.Component);window.backendUrl="http://localhost:8080","#list"===window.location.hash?s.a.render(r.a.createElement($,null),document.getElementById("root")):s.a.render(r.a.createElement(K,null),document.getElementById("root"))}},[[120,1,2]]]);
//# sourceMappingURL=main.b36ca635.chunk.js.map